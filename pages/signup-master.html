<!DOCTYPE html>

<html>
  
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="/css/master.css">
    <title>Find Sign Up</title>

  </head>

  <body>

	  	<header>
	  		<div class="headertopic">
	  			<div class="headerleft">
            <div>Find 師傅 - 家務修繕小幫手，師傅接案好輕鬆</div>
	  			</div>
	  			<div class="headeright">
		  			<a href="signin.html"><div id="signinlink">登入</div></a>
            <a href="/"><div id="index">回首頁</div></a>
            <a href="masterprocess.html"><div id="masterprocess">流程</div></a>
	  			</div>
	  		</div>
	  	</header>

	  	<div class="uparea"></div>

  		<main>

	  		<div id="basic">

  				<div id="inputdata">
  				
  					<div id="inputleft">
                <label id='namelabel'>姓名 ( Name )：</label>
                <label id='emaillabel'>郵箱 ( E-mail )：</label>
				        <label id='phonelabel'>手機號碼 ( Phone Number )：</label>
				        <label id="passwordlabel">密碼 ( Password )：</label>
			        </div>
			        
			        <div id="inputright">
                <input id="name" type="text" name="name">
                <input id="email" type="email" name="email">
			        	<input id="phone" type="text" name="phone" placeholder='ex: 0910999999' maxlength="10" minlength="10">
			        	<input id="password" type="password" name="password" placeholder='請輸入8-10位數' maxlength="10" minlength="8">
			        </div>        
		          			
  				</div>

	  			<div class='buttons'>
				      <div><button class='goto' type="button" onclick="ToSkill()">下一頁 ( next page )</button></div>  
	  			</div>
	  		</div>

        <div id="skill">

          <div id="checkskill">

            <div id="checkskilltitle">可裝修項目</div>

            <div id="skillchecklist">

              <div><input class="inputskill" type="checkbox" name="skill" value="light">燈具維修<br><br>
              <input class="inputskill" type="checkbox" name="skill" value="toilet">馬桶裝修<br><br>
              <input class="inputskill" type="checkbox" name="skill" value="waterheater">熱水器</div><br><br>
              <div><input class="inputskill" type="checkbox" name="skill" value="pipe">水管<br><br>
              <input class="inputskill" type="checkbox" name="skill" value="faucet">水龍頭<br><br>
              <input class="inputskill" type="checkbox" name="skill" value="bathtub">浴缸/淋浴設備</div><br><br>
              <div><input class="inputskill" type="checkbox" name="skill" value="wire">電線<br><br>
              <input class="inputskill" type="checkbox" name="skill" value="soil">補土<br><br>
              <input class="inputskill" type="checkbox" name="skill" value="paint">油漆</div><br><br>
              <div><input class="inputskill" type="checkbox" name="skill" value="wallpaper">壁紙<br><br>
              <input class="inputskill" type="checkbox" name="skill" value="tile">磁磚</div><br><br>

            </div>
          
      
                    
          </div>

          <div class='buttons'>
                <div><button class='goto' type="submit" onclick="ToArea()">下一頁 ( next page )</button></div>  
          </div>

        </div>

        <div id="area">

          <div id="checkarea">

            <div id="checkareatitle">可接單區域</div>

            <div id="areachecklist">

              <div><input class="inputarea" type="checkbox" name="city" value="台北">台北<br><br>
              <input class="inputarea" type="checkbox" name="city" value="新北">新北<br><br>
              <input class="inputarea" type="checkbox" name="city" value="基隆">基隆</div><br><br>
              <div><input class="inputarea" type="checkbox" name="city" value="桃園">桃園<br><br>
              <input class="inputarea" type="checkbox" name="city" value="新竹">新竹<br><br>
              <input class="inputarea" type="checkbox" name="city" value="苗栗">苗栗</div><br><br>
              <div><input class="inputarea" type="checkbox" name="city" value="台中">台中<br><br>
              <input class="inputarea" type="checkbox" name="city" value="彰化">彰化<br><br>
              <input class="inputarea" type="checkbox" name="city" value="雲林">雲林</div><br><br>
              <div><input class="inputarea" type="checkbox" name="city" value="嘉義">嘉義<br><br>
              <input class="inputarea" type="checkbox" name="city" value="台南">台南<br><br>
              <input class="inputarea" type="checkbox" name="city" value="高雄">高雄</div><br><br>
              <div><input class="inputarea" type="checkbox" name="city" value="屏東">屏東<br><br>
              <input class="inputarea" type="checkbox" name="city" value="宜蘭">宜蘭<br><br>
              <input class="inputarea" type="checkbox" name="city" value="花蓮">花蓮</div><br><br>
              <div><input class="inputarea" type="checkbox" name="city" value="台東">台東</div><br><br>

            </div>
                
                    
          </div>

          <div class='buttons'>
              <div><button class='goto' type="submit" onclick="sign_up()">註冊 ( Sign Up ) 當師傅</button></div>  
          </div>

        </div>


	  	</main>

    <script>

      function ToSkill(){

        let input_name = document.getElementById('name').value;
        let input_email = document.getElementById('email').value;
        let input_phone = document.getElementById('phone').value;
        let input_pass = document.getElementById('password').value;
        let split_email = input_email.split('@');

        if( input_name == '' || input_email == '' || input_phone == '' || input_pass == '' ){

          alert('未填寫完成');

        }else if( input_pass.length < 8 ){

          alert('密碼長度不足');

        }else if( input_phone.length < 10 ){

          alert('電話長度不足');

        }else if( input_phone[0] != 0 || input_phone[1] != 9 || isNaN( +999999999 - input_phone ) ){

          alert('電話格式錯誤');

        }else if( input_email.indexOf('@') == -1 || split_email[0] == '' || split_email[1] == '' ){

          alert( 'email 格式錯誤' );

        }else{

          let json_send = {};
          json_send.provider = 'master';
          json_send.email = input_email;
          json_send.name = input_name;
          json_send.phone = input_phone;
          json_send.password = input_pass;

          localStorage.setItem('masterbasic',JSON.stringify(json_send));

          let basic_data = document.getElementById('basic');
          let master_skill = document.getElementById('skill');

          basic_data.style.display = 'none';
          master_skill.style.display = 'flex';

        }

      }

      function ToArea(){

        let input_skill = document.getElementsByClassName('inputskill');

        let skill_array = [];

        for( let i = 0 ; i < input_skill.length ; i++ ){

          if( input_skill[i].checked ){

            skill_array.push(input_skill[i].value);

          }

        }

        if( skill_array.length == 0 ){

          alert('未選擇任一項目');

        }else{

          localStorage.setItem("master_skill",JSON.stringify(skill_array));

          let master_area = document.getElementById('area');
          let master_skill = document.getElementById('skill');

          master_area.style.display = 'flex';
          master_skill.style.display = 'none';

        }

      }


      function sign_up(){

        let input_area = document.getElementsByClassName('inputarea');

        let area_array = [];

        for( let j = 0 ; j < input_area.length ; j++ ){

          if( input_area[j].checked ){

            area_array.push(input_area[j].value);

          }

        }

        if( area_array.length == 0 ){

          alert('未選擇任一地區');

        }else{

          let json_send = JSON.parse(localStorage.getItem('masterbasic'));

          let skill_array = JSON.parse(localStorage.getItem('master_skill'));

          json_send.skill = skill_array;

          json_send.area = area_array;

          let send_json = JSON.stringify(json_send);

          let sign_up_data = new XMLHttpRequest();
        
          sign_up_data.onreadystatechange=function(){

            if(sign_up_data.readyState === 4){
              
             if (sign_up_data.status === 200){

                localStorage.removeItem('masterbasic');
                localStorage.removeItem('master_skill');

                let sign_upback = JSON.parse(sign_up_data.responseText);

                if( sign_upback.error ){

                  alert('已註冊過 / 輸入內容錯誤');

                  window.location.replace('sign_up-master.html');

                }else if( sign_upback.message ){

                  alert('新建 Stripe 帳戶失敗');

                  window.location.replace('sign_up-master.html');

                }else{

                  window.location.replace('mailsend.html');                

                }

              }
     
            }

          };

          sign_up_data.open('POST','/checktype/api/user/signup');

          sign_up_data.setRequestHeader("Content-Type",
                "application/json");        
         
          sign_up_data.send(send_json);

        }

      }

    </script>

  </body>
  
  <footer class="footer">

  		<p class="footerp">&copy;2019. All rights reserved.</p>

  </footer>

</html>
