<!DOCTYPE html>

<html>
  
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="/css/customer.css">
    <title>Find Sign Up</title>

  </head>

  <body>

	  	<header>
	  		<div class="headertopic">
	  			<div class="headerleft">
            <div>Find 師傅 - 家務修繕小幫手，師傅接案好輕鬆</div>
	  			</div>
	  			<div class="headeright">
		  			<a href="/user/signin"><div id="signinlink">登入</div></a>
            <a href="/process/customer"><div id="customerprocess">流程</div></a>
	  			</div>
	  		</div>
	  	</header>

	  	<div class="uparea"></div>

  		<main>

	  		<div id="login">

  				<div id="inputdata">
  				
  					<div id="inputleft">
                <label id='namelabel'>姓名 ( Name )：</label>
                <label id='addresslabel'>住址 ( Address )：</label>
				        <label id='phonelabel'>手機號碼 ( Phone Number )：</label>
				        <label id="passwordlabel">密碼 ( Password )：</label>
			        </div>
			        
			        <div id="inputright">
                <input id="name" type="text" name="name">
                <input id="address" type="text" name="address">
			        	<input id="phone" type="text" name="phone" placeholder='ex: 0910999999' maxlength="10" minlength="10">
			        	<input id="password" type="password" name="password" placeholder='請輸入8-10位數' maxlength="10" minlength="8">
			        </div>        
		          			
  				</div>

	  			<div class='buttons'>
				      <div><button class='goto' type="submit" onclick="SignUp()">註冊 ( Sign Up ) 找師傅</button></div>  
	  			</div>
	  		</div>


	  	</main>

    <script>

      function SignUp(){

        let inputname = document.getElementById('name').value;
        let inputaddress = document.getElementById('address').value;
        let inputphone = document.getElementById('phone').value;
        let inputpass = document.getElementById('password').value;

        if( inputname == '' || inputaddress == '' || inputphone == '' || inputpass == '' ){

          alert('未填寫完成');

        }else if( inputpass.length < 8 ){

          alert('密碼長度不足');

        }else if( inputphone.length < 10 ){

          alert('電話長度不足');

        }else if( inputphone[0] != 0 || inputphone[1] != 9 ){

          alert('電話格式錯誤');

        }else{

          var signupdata = new XMLHttpRequest();
        
          signupdata.onreadystatechange=function(){

            if(signupdata.readyState === 4){
              
             if (signupdata.status === 200){

                let signinback = JSON.parse(signupdata.responseText);

                if( signinback.error != null ){

                  alert('已註冊過 / 輸入內容錯誤');

                }else{

                  let backtoken = "Bearer " + signinback.data.access_token;         

                  sessionStorage.setItem("Auth",backtoken);

                  window.location.replace('/customer/searchmaster');

                }

              }
     
            }

          };

          signupdata.open('POST','/api/user/signup');

          signupdata.setRequestHeader("Content-Type",
                "application/json");

          

          let jsonsend = {};
          jsonsend.provider = 'customer';
          jsonsend.name = inputname;
          jsonsend.address = inputaddress;
          jsonsend.phone = inputphone;
          jsonsend.password = inputpass;

          let sendjson = JSON.stringify(jsonsend);

          signupdata.send(sendjson);

        }

      }

    </script>

  </body>
  
  <footer class="footer">

  		<p class="footerp">&copy;2019. All rights reserved.</p>

  </footer>

</html>
